<!DOCTYPE html>
<HTML>

<Head>

  <link type="text/css" rel ="stylesheet" href = "login.css"/>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase.js"></script>
  <script>
  // Initialize Firebase
  var firebaseConfig = {
    apiKey: "AIzaSyAJWkVyOlQhLk3nn-kzqYq_ZinqBgLRVUA",
    authDomain: "econergize.firebaseapp.com",
    databaseURL: "https://econergize.firebaseio.com",
    projectId: "econergize",
    storageBucket: "econergize.appspot.com",
    messagingSenderId: "626959907168",
    appId: "1:626959907168:web:d0e4e8ee943e86a0"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  </script>

</Head>

<Body>

  <div id="def-log-in">
    <form>
      <div>
        <label for="username">Username:</label>
        <input id="email" type="text" name="username" placeholder="mysupercoolemail@hmail.com"> <br>
      </div>
      <div>
        <label for="password">Password:</label>
        <input id="password" type="password" name="password" placeholder="hunter2">
      <div/>
      <div>
        <input id="log-in" type="submit" value="Log in">
        <div id="firebaseui-auth-container"></div>
      </div>

      <div id="login-button"></div>

  <!--Handle auth events-->
  <script>
    firebase.auth().onAuthStateChanged(function(user) {
      console.log(user);
      if (user !== null) {
        window.location = "index.html";
      }
    });
  </script>

  <!--Handle page events-->
  <script>
    document.querySelector('#log-in').addEventListener('click', function(e) {
      // Prevent refreshing to get POST data and prevent null auths
      e.preventDefault();
      e.stopPropagation();
      // Get query email and password info
      let email = document.querySelector('#email').value;;
      let password = document.querySelector('#password').value;
      // Firebase sign in
      firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        console.log(errorCode);
        console.log(errorMessage);
      })
    });
  </script>

</Body>

<script>
    window.snapKitInit = () => {
      snap.loginkit.mountButton("login-button", {
        clientId: "5414d722-7487-4d5b-9a92-221ccf07da6e",
        redirectURI: "http://localhost:5000",
        scopeList: [
          "user.display_name",
          "user.bitmoji.avatar",
        ],
        handleResponseCallback: () => {
          snap.loginkit.fetchUserInfo().then(data => {
            document.getElementById("login-button").classList.add("hidden")
            document.getElementById("profile").classList.remove("hidden")

            document.getElementById("picture").src = data["data"]["me"]["bitmoji"]["avatar"]
            document.getElementById("welcome").innerHTML = "Welcome, " + data["data"]["me"]["displayName"] + "!"
          })
        },
      })
    }

    // Load the SDK asynchronously
    (function (d, s, id) {
      var js, sjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "https://sdk.snapkit.com/js/v1/login.js";
      sjs.parentNode.insertBefore(js, sjs);
    }(document, "script", "loginkit-sdk"));
  </script>

</HTML>
